<!DOCTYPE html>
<html>
    <head>
        <title>Tape Json Editor</title>
    </head>

    <body>

        <!-- templates -->
        <script type="text/html" id="editable-node-id-template">
            <span data-bind="if: editable()"><input class="editable-node-input" data-bind="textInput: id, style: { 'background-color': hasError() ? '#ff3333' : 'initial'}"></input></span>
            <span data-bind="ifnot: editable()"><span class="editable-node-display" data-bind="text: id, style: { 'background-color': hasError() ? '#ff3333' : 'initial'}"></span></span>
        </script>

        <!-- <script type="text/html" id="editable-node-line-template">
            <tr class="editable-node" data-bind="if: editable()">
                <td class="editable-node-input"><input data-bind="textInput: alues.sayer"></input></td>
                <td class="editable-node-input"><input data-bind="textInput: values.words"></input></td>
            </tr>
            <tr class="editable-node" data-bind="ifnot: editable()">
                <td class="editable-node-display"><b><span data-bind="text: values.sayer"></span> : </b></td>
                <td class="editable-node-display"><span data-bind="text: values.words"></span></td>
            </tr>
        </script> -->

        <!-- app -->
        <div id="app">

            <!-- old display with nodes -->

            <!-- <div class="all-nodes">
                <div class="node" data-bind="foreach: { data: sets, as: 'node' }">
                    <div class="node-element" data-bind="contentEditable: node.editable(), text: node.id"></div>
                    <div class="node" data-bind="foreach: { data: node.children, as: 'childnode' }">
                        <div class="node-element" data-bind="contentEditable: childnode.editable(), text: childnode.id"></div>
                        <div class="node" data-bind="foreach: { data: childnode.children, as: 'grandchildnode' }">
                            <div><b><span class="node-element" data-bind="contentEditable: grandchildnode.editable(), text: grandchildnode.values.sayer"></span> says: </b><span class="node-element" data-bind="contentEditable: grandchildnode.editable(), text: grandchildnode.values.words"></span></div>
                        </div>
                    </div>
                </div>
            </div> -->

            <!-- Set and conversation tree -->

            <div id="tree">
                <div class="all-nodes">
                    <div class="node" data-bind="foreach: { data: allNodes, as: 'set' }">
                        <!-- <div class="node-id" data-bind="contentEditable: set.editable(), textInput: set.id"></div> -->
                        <span class="expand-collapse"></span>
                        <span class="editable-node" data-bind="template: { name: 'editable-node-id-template', data: set }"></span>

                        <div class="node" data-bind="visible: set.expanded(), foreach: { data: set.conversations, as: 'conv'}">
                           <!-- <div class="node-id" data-bind="contentEditable: conv.editable(), textInput: conv.id"></div> -->
                            <div class="editable-node conversation-node" data-bind="visible: set.expanded(), template: { name: 'editable-node-id-template', data: conv }"></div>                          

                        </div>

                        <div class="add-node conv" data-bind="visible: set.expanded()"></div>

                        <!-- space -->
                        <div data-bind="hidden: set.expanded()"></div>
                        
                    </div>

                    <div class="add-node conv-set"></div>

                </div>

            </div>

            <!-- Save/Load buttons -->

            <div id="save-load-buttons">
                <button id="save-file-button">Save File</button>
                <button id="load-file-button">Load File</button>
                <input id="file-input" type="file" name="name" style="display: none"></input>
                <div></div>
            </div>

            <!-- Conversation display (lines) -->

            <div id="conv-details" data-bind="if: visibleConversation()">
                <table class="conv-table">
                    <thead>
                        <tr>
                            <td><i>Sayer</i></td>
                            <td><i>Words</i></td>
                        </tr>
                    </thead>
                    <!-- <tbody data-bind="template: { name: 'editable-node-line-template', foreach: visibleConversation().lines }">
                    </tbody> -->
                    <tbody data-bind="foreach: {data: visibleConversation().lines, as: 'line'}">

                        <tr data-bind="foreach: $parent.meta.lineValuesOrder">
                            <td><input class="line-input" data-bind="textInput: line.lineValues[$data]"></input></td>
                        </tr>
                        
                    </tbody>
                </table>
                <div class="add-node line"></div>
            </div>

        </div>      

    </body>
</html>